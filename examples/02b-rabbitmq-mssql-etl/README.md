# Example 02b: MSSQL ‚Üí RabbitMQ ETL Pipeline

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–º –ø—Ä–∏–º–µ—Ä–æ–º

### –°—Ç–∞—Ä—ã–π –ø–æ–¥—Ö–æ–¥ (examples/02-rabbitmq-mssql)
```
main.go:               461 —Å—Ç—Ä–æ–∫–∞
- –†—É—á–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ MSSQL
- –≠–∫—Å–ø–æ—Ä—Ç —á–µ—Ä–µ–∑ –∞–¥–∞–ø—Ç–µ—Ä—ã
- –ú–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ processors
- –†—É—á–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ RabbitMQ
- –ê—É–¥–∏—Ç –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- 5 —Ç–µ—Å—Ç–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
```

### –ù–æ–≤—ã–π –ø–æ–¥—Ö–æ–¥ (ETL Pipeline)
```
pipeline.yaml:         ~80 —Å—Ç—Ä–æ–∫
- –î–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- SQL-based –º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞
- –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –∞—É–¥–∏—Ç
```

**–≠–∫–æ–Ω–æ–º–∏—è:** ~380 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞ (82%)

## üöÄ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ ETL –ø–æ–¥—Ö–æ–¥–∞

### 1. **–ü—Ä–æ—Å—Ç–æ—Ç–∞**
```yaml
# –í–º–µ—Å—Ç–æ 50+ —Å—Ç—Ä–æ–∫ Go –∫–æ–¥–∞:
output:
  type: rabbitmq
  rabbitmq:
    host: localhost
    port: 5672
    queue: tdtp-orders
```

### 2. **SQL-based –º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ**
```sql
-- –ü—Ä—è–º–æ –≤ SQL –∑–∞–ø—Ä–æ—Å–µ (–≤–º–µ—Å—Ç–æ Go processors):
CONCAT(LEFT(email, 1), '***@', ...) AS customer_email
```

### 3. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏–∑ –∫–æ—Ä–æ–±–∫–∏**
- READ-ONLY —Ä–µ–∂–∏–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- SQL –≤–∞–ª–∏–¥–∞—Ü–∏—è
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

### 4. **–ù–µ—Ç –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è**
- DBA –º–æ–∂–µ—Ç –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –±–µ–∑ –∑–Ω–∞–Ω–∏—è Go
- SQL + YAML - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –Ω–∞–≤—ã–∫–∏

## üì¶ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ß–µ—Ä–µ–∑ CLI:
```bash
# Safe mode (READ-ONLY)
tdtpcli --pipeline pipeline.yaml

# –° –∞—É–¥–∏—Ç–æ–º
tdtpcli --pipeline pipeline.yaml --audit
```

### –ß–µ—Ä–µ–∑ Go –∫–æ–¥ (–µ—Å–ª–∏ –Ω—É–∂–Ω–∞ –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è):
```go
package main

import (
    "context"
    "log"

    "github.com/ruslano69/tdtp-framework-main/pkg/etl"
)

func main() {
    ctx := context.Background()

    // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
    config, err := etl.LoadConfig("pipeline.yaml")
    if err != nil {
        log.Fatal(err)
    }

    // –°–æ–∑–¥–∞–µ–º –∏ –∑–∞–ø—É—Å–∫–∞–µ–º ETL –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä
    processor := etl.NewProcessor(config)
    if err := processor.Execute(ctx); err != nil {
        log.Fatal(err)
    }

    // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
    stats := processor.GetStats()
    log.Printf("Exported %d rows in %s", stats.TotalRowsLoaded, stats.Duration)
}
```

## üîç –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤–Ω—É—Ç—Ä–∏

1. **–ó–∞–≥—Ä—É–∑–∫–∞** –∏–∑ MSSQL:
   - –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è SQL —Å –º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ–º
   - –ó–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–ø–ª–∞—á–µ–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—ã

2. **Workspace** (SQLite :memory:):
   - –î–∞–Ω–Ω—ã–µ –ø–æ–º–µ—â–∞—é—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü—É `orders`

3. **–¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è**:
   - –í—ã–±–∏—Ä–∞–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ (—É–∂–µ –∑–∞–º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ)

4. **–≠–∫—Å–ø–æ—Ä—Ç** –≤ RabbitMQ:
   - –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è TDTP XML
   - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ –æ—á–µ—Ä–µ–¥—å `tdtp-orders`

## üéØ –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ETL

**–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ ETL Pipeline –∫–æ–≥–¥–∞:**
- ‚úÖ –õ–æ–≥–∏–∫–∞ –≤—ã—Ä–∞–∂–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ SQL
- ‚úÖ –ù—É–∂–Ω–∞ –ø—Ä–æ—Å—Ç–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ë–î ‚Üí Message Broker
- ‚úÖ –¢—Ä–µ–±—É–µ—Ç—Å—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º–æ—Å—Ç—å –±–µ–∑ –∫–æ–¥–∞
- ‚úÖ DBA/–∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –¥–æ–ª–∂–Ω—ã —É–ø—Ä–∞–≤–ª—è—Ç—å –ø—Ä–æ—Ü–µ—Å—Å–æ–º

**–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Go –∫–æ–¥ –∫–æ–≥–¥–∞:**
- ‚ùå –°–ª–æ–∂–Ω–∞—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
- ‚ùå –ù—É–∂–Ω—ã custom processors
- ‚ùå –¢—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–æ–≥—Ä–∞–º–º–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- MSSQL —Å —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ (—Å–º. examples/02-rabbitmq-mssql/setup.sql)
- RabbitMQ –Ω–∞ localhost:5672
- –û—á–µ—Ä–µ–¥—å `tdtp-orders`

## üîó –°–º. —Ç–∞–∫–∂–µ

- [ETL Pipeline Guide](../../docs/ETL_PIPELINE_GUIDE.md)
- [–û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –ø—Ä–∏–º–µ—Ä 02](../02-rabbitmq-mssql/)
