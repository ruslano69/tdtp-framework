# üìä –ê–ù–ê–õ–ò–ó XLSX –ê–î–ê–ü–¢–ï–†–ê

**–î–∞—Ç–∞:** 2026-02-20
**–¶–µ–ª—å:** –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã —ç–∫—Å–ø–æ—Ä—Ç–∞/–∏–º–ø–æ—Ä—Ç–∞ XLSX —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Ç–∏–ø–æ–≤

---

## ‚úÖ –≠–ö–°–ü–û–†–¢ (TDTP ‚Üí XLSX)

### –§—É–Ω–∫—Ü–∏—è: `ToXLSX(packet, filePath, sheetName)`
**–§–∞–π–ª:** `pkg/xlsx/converter.go:25-132`

**–ê–ª–≥–æ—Ä–∏—Ç–º:**

1. **–î–µ–∫–æ–º–ø—Ä–µ—Å—Å–∏—è** (—Å—Ç—Ä–æ–∫–∞ 31-48):
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç `pkt.Data.Compression`
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `processors.DecompressDataForTdtp()`
   - –ó–∞–º–µ–Ω—è–µ—Ç —Å–∂–∞—Ç—É—é —Å—Ç—Ä–æ–∫—É –Ω–∞ –º–∞—Å—Å–∏–≤ —Å—Ç—Ä–æ–∫

2. **–ó–∞–≥–æ–ª–æ–≤–∫–∏ —Å —Ç–∏–ø–∞–º–∏** (—Å—Ç—Ä–æ–∫–∞ 76-84):
   ```go
   header := fmt.Sprintf("%s (%s)", field.Name, field.Type)
   if field.Key {
       header += " *"  // –ú–∞—Ä–∫–µ—Ä –ø–µ—Ä–≤–∏—á–Ω–æ–≥–æ –∫–ª—é—á–∞
   }
   ```
   **–ü—Ä–∏–º–µ—Ä:** `customer_id (INTEGER) *`, `amount (REAL)`

3. **–ö–æ–Ω–≤–µ—Ä—Å–∏—è –¥–∞–Ω–Ω—ã—Ö** (—Å—Ç—Ä–æ–∫–∞ 104-122):
   ```go
   // –ü–∞—Ä—Å–∏—Ç –∑–Ω–∞—á–µ–Ω–∏—è —Å —É—á—ë—Ç–æ–º escape-–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–µ–π
   values := pktParser.GetRowValues(row)

   // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –≤ —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
   tv, err := conv.ParseValue(values[col], fieldDefs[col])
   //         ‚Üë schema.Converter ‚Äî –ù–ï –¥—É–±–ª–∏–∫–∞—Ç!

   // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –≤ Excel —Ñ–æ—Ä–º–∞—Ç
   cellValue = typedValueToExcel(tv)
   ```

4. **–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —è—á–µ–µ–∫** (—Å—Ç—Ä–æ–∫–∞ 120, —Ñ—É–Ω–∫—Ü–∏—è 274-287):
   ```go
   applyCellFormat(f, sheetName, cell, schema.DataType(fld.Type))
   ```
   - `INTEGER/INT` ‚Üí Excel —á–∏—Å–ª–æ–≤–æ–π —Ñ–æ—Ä–º–∞—Ç (style 1)
   - `REAL/FLOAT/DOUBLE/DECIMAL` ‚Üí Excel –¥—Ä–æ–±–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç (style 2)
   - `DATE` ‚Üí Excel —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã (style 14)
   - `DATETIME/TIMESTAMP` ‚Üí Excel —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã-–≤—Ä–µ–º–µ–Ω–∏ (style 22)
   - –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é ‚Üí —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç (style 49)

**–¢–ò–ü–´ –°–û–•–†–ê–ù–Ø–Æ–¢–°–Ø:** ‚úÖ
- –í –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö: `field_name (TYPE)`
- –í —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ —è—á–µ–µ–∫ (Excel native formats)
- –í –∑–Ω–∞—á–µ–Ω–∏—è—Ö (—á–µ—Ä–µ–∑ schema.TypedValue)

---

## ‚úÖ –ò–ú–ü–û–†–¢ (XLSX ‚Üí TDTP)

### –§—É–Ω–∫—Ü–∏—è: `FromXLSX(filePath, sheetName)`
**–§–∞–π–ª:** `pkg/xlsx/converter.go:134-208`

**–ê–ª–≥–æ—Ä–∏—Ç–º:**

1. **–ü–∞—Ä—Å–∏–Ω–≥ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤** (—Å—Ç—Ä–æ–∫–∞ 164-173):
   ```go
   name, fieldType, isKey := parseHeader(header)
   //                        ‚Üë parseHeader() –Ω–∞ —Å—Ç—Ä–æ–∫–µ 211-232
   //                          –ò–∑–≤–ª–µ–∫–∞–µ—Ç –∏–∑ "field_name (TYPE) *"

   fields = append(fields, packet.Field{
       Name: name,
       Type: string(fieldType),  // ‚Üê –¢–ò–ü–´ –í–û–°–°–¢–ê–ù–ê–í–õ–ò–í–ê–Æ–¢–°–Ø!
       Key:  isKey,
   })
   ```

2. **–§—É–Ω–∫—Ü–∏—è parseHeader** (—Å—Ç—Ä–æ–∫–∞ 211-232):
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –º–∞—Ä–∫–µ—Ä –∫–ª—é—á–∞ ` *`
   - –ò–∑–≤–ª–µ–∫–∞–µ—Ç —Ç–∏–ø –∏–∑ —Å–∫–æ–±–æ–∫ `(TYPE)`
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: –∏–º—è, —Ç–∏–ø, isKey

3. **–ü–∞—Ä—Å–∏–Ω–≥ –¥–∞–Ω–Ω—ã—Ö** (—Å—Ç—Ä–æ–∫–∞ 190-205):
   ```go
   values[col] = convertFromExcel(dataRow[col], schema.DataType(field.Type))
   //            ‚Üë –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç —Å —É—á—ë—Ç–æ–º —Ç–∏–ø–∞ (—Å—Ç—Ä–æ–∫–∞ 257-271)
   ```

4. **–°–æ–∑–¥–∞–Ω–∏–µ DataPacket** (—Å—Ç—Ä–æ–∫–∞ 176-187):
   - –°—Ö–µ–º–∞ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
   - –¢–∏–ø—ã –ø–æ–ª–µ–π —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è
   - –î–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É—é—Ç—Å—è –≤ TDTP —Ñ–æ—Ä–º–∞—Ç (pipe-delimited)

**–¢–ò–ü–´ –í–û–°–°–¢–ê–ù–ê–í–õ–ò–í–ê–Æ–¢–°–Ø:** ‚úÖ

---

## üéØ –ü–†–ò–ú–ï–†–´ –†–ê–ë–û–¢–´

### –≠–ö–°–ü–û–†–¢:
```
INPUT (TDTP):
Schema:
  customer_id: INTEGER (KEY)
  amount: REAL
  name: TEXT
  created: DATETIME

OUTPUT (XLSX):
Header Row:
  | customer_id (INTEGER) * | amount (REAL) | name (TEXT) | created (DATETIME) |

Data Row:
  | 12345 (Number)         | 999.50 (Number) | John (Text) | 2024-01-15 10:30 (DateTime) |

Excel Cell Formats:
  - customer_id: Number format, no decimals
  - amount: Number format, 2 decimals
  - name: Text format
  - created: DateTime format (yyyy-mm-dd hh:mm:ss)
```

### –ò–ú–ü–û–†–¢:
```
INPUT (XLSX):
Header:
  | customer_id (INTEGER) * | amount (REAL) | name (TEXT) | created (DATETIME) |

OUTPUT (TDTP):
Schema –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞:
  Fields:
    - Name: customer_id, Type: INTEGER, Key: true
    - Name: amount, Type: REAL, Key: false
    - Name: name, Type: TEXT, Key: false
    - Name: created, Type: DATETIME, Key: false

Data –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞:
  Row: "12345|999.50|John|2024-01-15 10:30:00"
```

---

## üìã –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –î–ï–¢–ê–õ–ò

### –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

1. **packet.Parser** (—Å—Ç—Ä–æ–∫–∞ 87):
   - `GetRowValues()` ‚Äî –ø–∞—Ä—Å–∏–Ω–≥ —Å escape-–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—è–º–∏
   - –ü—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç `\|` –∏ `\\` –≤ –∑–Ω–∞—á–µ–Ω–∏—è—Ö

2. **schema.Converter** (—Å—Ç—Ä–æ–∫–∞ 88):
   - `ParseValue()` ‚Äî –∫–æ–Ω–≤–µ—Ä—Å–∏—è —Å—Ç—Ä–æ–∫–∏ ‚Üí TypedValue
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–∏–ø—ã –∏–∑ —Å—Ö–µ–º—ã
   - –ù–ï –¥—É–±–ª–∏–∫–∞—Ç –ª–æ–≥–∏–∫–∏!

3. **excelize** (–ø–∞–∫–µ—Ç github.com/xuri/excelize/v2):
   - `NewFile()` ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ XLSX
   - `SetCellValue()` ‚Äî —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–Ω–∞—á–µ–Ω–∏—è
   - `SetCellStyle()` ‚Äî –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º–∞—Ç–æ–≤
   - `GetRows()` ‚Äî —á—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

### –ö–æ–Ω–≤–µ—Ä—Å–∏—è —Ç–∏–ø–æ–≤:

**typedValueToExcel** (—Å—Ç—Ä–æ–∫–∞ 236-254):
```go
switch {
case tv.IntValue != nil:    return *tv.IntValue      // ‚Üí Excel Number
case tv.FloatValue != nil:  return *tv.FloatValue    // ‚Üí Excel Number
case tv.BoolValue != nil:   return "TRUE"/"FALSE"    // ‚Üí Excel Text (!)
case tv.TimeValue != nil:   return *tv.TimeValue     // ‚Üí Excel DateTime
case tv.StringValue != nil: return *tv.StringValue   // ‚Üí Excel Text
default:                    return tv.RawValue        // ‚Üí Excel Text
}
```

**convertFromExcel** (—Å—Ç—Ä–æ–∫–∞ 257-271):
```go
switch fieldType {
case TypeBoolean, TypeBool:
    if value == "TRUE" || value == "true":
        return "1"  // TDTP boolean true
    return "0"      // TDTP boolean false
default:
    return value    // –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
}
```

---

## ‚úÖ –í–´–í–û–î–´

### –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ:

1. **–¢–∏–ø—ã –ù–ï —Ç–µ—Ä—è—é—Ç—Å—è** ‚úÖ
   - –°–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö XLSX: `field_name (TYPE)`
   - –ü—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –ø—Ä–∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ —è—á–µ–µ–∫ (Excel native)
   - –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ —á–µ—Ä–µ–∑ parseHeader()

2. **–ò—Å–ø–æ–ª—å–∑—É–µ—Ç schema.Converter** ‚úÖ
   - –ù–ï –¥—É–±–ª–∏–∫–∞—Ç –ª–æ–≥–∏–∫–∏ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏!
   - –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ pkg/core/schema

3. **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –¥–µ–∫–æ–º–ø—Ä–µ—Å—Å–∏—é** ‚úÖ
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–µ–∫–æ–º–ø—Ä–µ—Å—Å–∏—Ä—É–µ—Ç —Å–∂–∞—Ç—ã–µ –ø–∞–∫–µ—Ç—ã
   - –†–∞–±–æ—Ç–∞–µ—Ç —Å `processors.DecompressDataForTdtp()`

4. **–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Excel** ‚úÖ
   - –ß–∏—Å–ª–∞ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–∞–∫ —á–∏—Å–ª–∞ (–º–æ–∂–Ω–æ —Å—É–º–º–∏—Ä–æ–≤–∞—Ç—å)
   - –î–∞—Ç—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–∞–∫ –¥–∞—Ç—ã (–º–æ–∂–Ω–æ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å)
   - –¢–µ–∫—Å—Ç –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–∞–∫ —Ç–µ–∫—Å—Ç

5. **–û–±—Ä–∞–±–æ—Ç–∫–∞ escape-–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–µ–π** ‚úÖ
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `packet.Parser.GetRowValues()`
   - –ü—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç `\|` –∏ `\\`

### –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:

1. **Boolean —Ñ–æ—Ä–º–∞—Ç** (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ):
   - –°–µ–π—á–∞—Å: TRUE/FALSE –∫–∞–∫ —Ç–µ–∫—Å—Ç
   - –ú–æ–∂–Ω–æ: Excel native boolean
   - –ü—Ä–∏—á–∏–Ω–∞: —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —Ä–∞–∑–Ω—ã–º–∏ –≤–µ—Ä—Å–∏—è–º–∏ Excel

2. **–ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —à–∏—Ä–∏–Ω—ã –∫–æ–ª–æ–Ω–æ–∫** (–µ—Å—Ç—å):
   - –°–µ–π—á–∞—Å: —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —à–∏—Ä–∏–Ω–∞ 15
   - –°—Ç—Ä–æ–∫–∞ 127: `f.SetColWidth(sheetName, colName, colName, 15)`
   - –ú–æ–∂–Ω–æ: dynamic auto-fit

---

## üéØ –ò–¢–û–ì:

**–ü–†–û–ë–õ–ï–ú –ù–ï–¢! XLSX –ê–î–ê–ü–¢–ï–† –†–ê–ë–û–¢–ê–ï–¢ –ü–†–ê–í–ò–õ–¨–ù–û!** üéâ

- –¢–∏–ø—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è ‚úÖ
- –ö–æ–Ω–≤–µ—Ä—Å–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è ‚úÖ
- –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Excel native ‚úÖ
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ (–Ω–µ –≤–µ–ª–æ—Å–∏–ø–µ–¥) ‚úÖ
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–∂–∞—Ç–∏–µ ‚úÖ
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç escape-–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ ‚úÖ
